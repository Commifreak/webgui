Menu="VMs:1"
Title="Create VM"
Cond="(pgrep('libvirtd')!==false)"
Markdown="false"
---
<?php
if (array_key_exists('sent', $_POST)) {

	$tmp = $lv->domain_new($_POST['domain'], $_POST['media'], $_POST['nic'], $_POST['disk'], $_POST['usb'], $_POST['shares'], $_POST['gpu'], $_POST['audio']);
	if (!$tmp){
		echo "<script type='text/javascript'>$(function() { $('#countdown').html('<font class=\"red\">Error: ".$lv->get_last_error()."</font>');}); </script>";
	} else {
  		$name = $_POST['domain']['name'];
		$res = $lv->get_domain_by_name($name);
		$uuid = libvirt_domain_get_uuid_string($res);
		echo "<script type='text/javascript'>$(function() { $('#countdown').html('<font class=\"green\">Domain $name&nbsp; has been created</font>');}); </script>";
		echo '<meta http-equiv="refresh" content="1; url=/VMs">';
	}
}
?>

<link type="text/css" rel="stylesheet" href="/webGui/styles/jquery.switchButton.css">
<style type="text/css">
	#createform table + table {
		margin-top: 0;
	}
	#createform table tr {
		vertical-align: top;
		line-height: 24px;
	}
	#createform table tr td:nth-child(odd) {
		width: 150px;
		text-align: right;
		padding-right: 10px;
	}
	#createform table tr td:nth-child(even) {
		width: 80px;
	}
	#createform table tr td:last-child {
		width: inherit;
	}
</style>

<div id="content" style="margin-top:-42px;margin-left:0px">

<!--table class="tablesorter" id="createvm" style="margin-top:-21px;margin-left:0px">
	<thead><th colspan="2">Create New Virtual Machine From Template</th></thead>
</table-->

<form id="createform" method="POST">
<input type="hidden" name="sent" value="1" />
<input type="hidden" name="domain[type]" value="<?php echo is_dir('/proc/xen') ? 'xen' : 'kvm'; ?>" />

<?php

	$arrTemplates = array();
	$strSelectedTemplate = '';

	// Read files from the templates folder
	foreach (glob('plugins/dynamix.kvm.manager/templates/*.form.php', GLOB_NOSORT) as $template) {
		$arrTemplates[] = basename($template, '.form.php');
	}

	if (!empty($arrTemplates)) {
		$strSelectedTemplate = $arrTemplates[0];
	}

?>

<div id="title">
	<span class="left"><img src="/plugins/dynamix.docker.manager/icons/vcard.png" class="icon">Identity</span>
</div>

<table>
	<tr>
		<td>Template:</td>
		<td>
			<select onchange="loadTemplateForm(this.value);" name="domain[template]" autofocus title="Select domain operating system type. Windows or Other for Linux, OSX and others">
				<?php
					foreach ($arrTemplates as $strTemplate) {
						echo mk_option($strSelectedTemplate, $strTemplate, str_replace('_', ' ', $strTemplate));
					}
				?>
			</select><img src="/webGui/images/spinner.gif" style="display: none">
		</td>
	</tr>
	<tr>
		<td>Name:</td>
		<td><input type="text" name="domain[name]" class="textTemplate" title="Name of virtual machine" placeholder="e.g. My Workstation" /></td>
	</tr>
	<tr>
		<td>Description:</td>
		<td><input type="text" name="domain[desc]" title="description of vitual machine" placeholder="description of vitual machine (optional)" /></td>
	</tr>
	<tr style="line-height: 15px; vertical-align: middle;">
		<td>Autostart:</td>
		<td><div style="margin-left: -10px"><input type="checkbox" name="domain[autostart]" class="autostart" value="1"></div></td>
	</tr>
</table>

<div id="title">
	<span class="left"><img src="/plugins/dynamix.docker.manager/icons/preferences.png" class="icon">Template Settings</span>
</div>

<div id="form_content">
	<?php include('plugins/dynamix.kvm.manager/templates/' . $strSelectedTemplate . '.form.php'); ?>
</div>

</form>
</div>

<script type="text/javascript" src="/webGui/scripts/jquery.switchButton.js"></script>
<script type="text/javascript">
$(function() {
	$('.autostart').switchButton({
		on_label: 'Yes',
		off_label: 'No',
		labels_placement: "right"
	});
});
</script>

