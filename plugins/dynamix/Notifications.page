Menu="UserPreferences"
Type="xmenu"
Title="Notification Settings"
Icon="notifications.png"
---
<?PHP
/* Copyright 2012, Andrew Hamer-Adams, http://www.pixeleyes.co.nz.
 * Copyright 2014, Bergware International.
 * Copyright 2014, Lime Technology
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License version 2,
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 */
?>
<?
$events = explode('|', $notify['events']);
?>
<script>
function resetNotify(form) {
  form.date.selectedIndex = 0;
  form.time.selectedIndex = 0;
  form.path.value = "/tmp/notifications";
  form.position.selectedIndex = 1;
  form.normal1.checked = true;
  form.normal2.checked = false;
  form.warning1.checked = true;
  form.warning2.checked = false;
  form.alert1.checked = true;
  form.alert2.checked = false;
  form.status.selectedIndex = 0;
  form.plugin1.checked = true;
  form.plugin2.checked = false;
  form.report1.checked = true;
  form.report2.checked = false;
  for (var i=1; i<=5; i++) form.elements['a'+i].checked = true;
  form.custom.value = '';
}
function prepareNotify(form) {
  var events = [];
  form.entity.value = form.normal1.checked | form.warning1.checked | form.alert1.checked;
  form.normal.value = form.normal1.checked*1 + form.normal2.checked*2;
  form.warning.value = form.warning1.checked*1 + form.warning2.checked*2;
  form.alert.value = form.alert1.checked*1 + form.alert2.checked*2;
  form.plugin.value = form.plugin1.checked*1 + form.plugin2.checked*2;
  form.report.value = form.report1.checked*1 + form.report2.checked*2;
  form.normal1.disabled = true;
  form.normal2.disabled = true;
  form.warning1.disabled = true;
  form.warning2.disabled = true;
  form.alert1.disabled = true;
  form.alert2.disabled = true;
  form.plugin1.disabled = true;
  form.plugin2.disabled = true;
  form.report1.disabled = true;
  form.report2.disabled = true;
  for (var i=1; i<=5; i++) {
    if (form.elements['a'+i].checked) events.push(form.elements['a'+i].value);
    form.elements['a'+i].disabled = true;
  }
  if (form.custom.value>0) events.push(form.custom.value);
  form.events.value = events.join('|');
}
function preparePlugin(value) {
  if (value=='') $('.plugin').hide(); else $('.plugin').show();
}
function prepareReport(value) {
  if (value=='') $('.report').hide(); else $('.report').show();
}
$(function(){
  preparePlugin(document.notify_settings.version.value);
  prepareReport(document.notify_settings.status.value);
});
</script>
<form markdown="1" name="notify_settings" method="POST" action="/update.php" target="progressFrame" onsubmit="prepareNotify(this)">
<input type="hidden" name="#file" value="dynamix/dynamix.cfg">
<input type="hidden" name="#section" value="notify">
<input type="hidden" name="#command" value="/usr/local/sbin/notify cron-init">
<input type="hidden" name="entity">
<input type="hidden" name="normal">
<input type="hidden" name="warning">
<input type="hidden" name="alert">
<input type="hidden" name="plugin">
<input type="hidden" name="report">
<input type="hidden" name="events">

Date format:
: <select name="date" size="1">
  <?=mk_option($notify['date'], "d-m-Y", "DD-MM-YYYY")?>
  <?=mk_option($notify['date'], "m-d-Y", "MM-DD-YYYY")?>
  <?=mk_option($notify['date'], "Y-m-d", "YYYY-MM-DD")?>
  </select>

Time format:
: <select name="time" size="1">
  <?=mk_option($notify['time'], "h:i A", "12 hours")?>
  <?=mk_option($notify['time'], "H:i", "24 hours")?>
  </select>

Display position:
: <select name="position" size="1">
  <?=mk_option($notify['position'], "top-left", "top-left")?>
  <?=mk_option($notify['position'], "top-right", "top-right")?>
  <?=mk_option($notify['position'], "bottom-left", "bottom-left")?>
  <?=mk_option($notify['position'], "bottom-right", "bottom-right")?>
  <?=mk_option($notify['position'], "center", "center")?>
  </select>

Storage path:
: <input type="text" name="path" value="<?=$notify['path']?>"><?=(exec("echo {$notify['path']}|grep '^/mnt'") ? 'Permanent storage' : 'Temporary storage')?>

Plugins status notification:
: <select name="version" size="1" onchange="preparePlugin(this.value)">
  <?=mk_option($notify['version'], "", "Never check")?>
  <?=mk_option($notify['version'], "10 */6 * * *", "Check four times a day")?>
  <?=mk_option($notify['version'], "10 0,12 * * *", "Check twice a day")?>
  <?=mk_option($notify['version'], "10 0 * * *", "Check once a day")?>
  <?=mk_option($notify['version'], "10 0 * * 1", "Check once a week")?>
  <?=mk_option($notify['version'], "10 0 1 * *", "Check once a month")?>
  </select>

Array status notification:
: <select name="status" size="1" onchange="prepareReport(this.value)">
  <?=mk_option($notify['status'], "", "Never send")?>
  <?=mk_option($notify['status'], "20 * * * *", "Send every hour")?>
  <?=mk_option($notify['status'], "20 */2 * * *", "Send every two hours")?>
  <?=mk_option($notify['status'], "20 */6 * * *", "Send four times a day")?>
  <?=mk_option($notify['status'], "20 */8 * * *", "Send three times a day")?>
  <?=mk_option($notify['status'], "20 0,12 * * *", "Send twice a day")?>
  <?=mk_option($notify['status'], "20 0 * * *", "Send once a day")?>
  </select>

<span class="plugin" style="display:none">&nbsp;</span>
: <span class="plugin" style="display:none"><span style="display:inline-block;width:90px;font-style:italic">Plugins status</span><input type="checkbox" name="plugin1"<?=($notify['plugin'] & 1)==1 ? ' checked' : ''?>>Browser &nbsp;
  <input type="checkbox" name="plugin2"<?=($notify['plugin'] & 2)==2 ? ' checked' : ''?>>Email &nbsp;</span>

<span class="report" style="display:none">&nbsp;</span>
: <span class="report" style="display:none"><span style="display:inline-block;width:90px;font-style:italic">Array status</span><input type="checkbox" name="report1"<?=($notify['report'] & 1)==1 ? ' checked' : ''?>>Browser &nbsp;
  <input type="checkbox" name="report2"<?=($notify['report'] & 2)==2 ? ' checked' : ''?>>Email &nbsp;</span>

Notification entity:
: <span style="display:inline-block;width:90px;font-style:italic">Notices</span><input type="checkbox" name="normal1"<?=($notify['normal'] & 1)==1 ? ' checked' : ''?>>Browser &nbsp;
  <input type="checkbox" name="normal2"<?=($notify['normal'] & 2)==2 ? ' checked' : ''?>>Email &nbsp;

&nbsp;
: <span style="display:inline-block;width:90px;font-style:italic">Warnings</span><input type="checkbox" name="warning1"<?=($notify['warning'] & 1)==1 ? ' checked' : ''?>>Browser &nbsp;
  <input type="checkbox" name="warning2"<?=($notify['warning'] & 2)==2 ? ' checked' : ''?>>Email &nbsp;

&nbsp;
: <span style="display:inline-block;width:90px;font-style:italic">Alerts</span><input type="checkbox" name="alert1"<?=($notify['alert'] & 1)==1 ? ' checked' : ''?>>Browser &nbsp;
  <input type="checkbox" name="alert2"<?=($notify['alert'] & 2)==2 ? ' checked' : ''?>>Email &nbsp;

&nbsp;
: <button type="button" name="#advanced" onclick="if ($('.advanced').css('display')=='none') {$('.advanced').show(); $(this).html('Basic view');} else {$('.advanced').hide(); $(this).html('Advanced view');}">Advanced view</button>

<span class="advanced" style="display:none">SMART attribute notifications:</span>
: <span class="advanced" style="display:none"><input type="checkbox" name="a1" value="5"<?=in_array(5,$events) ? ' checked' : ''?>><span style="display:inline-block;width:72px">5</span>Reallocated sectors count</span>

<span class="advanced" style="display:none">&nbsp;</span>
: <span class="advanced" style="display:none"><input type="checkbox" name="a2" value="187"<?=in_array(187,$events) ? ' checked' : ''?>><span style="display:inline-block;width:72px">187</span>Reported uncorrectable errors</span>

<span class="advanced" style="display:none">&nbsp;</span>
: <span class="advanced" style="display:none"><input type="checkbox" name="a3" value="188"<?=in_array(188,$events) ? ' checked' : ''?>><span style="display:inline-block;width:72px">188</span>Command timeout</span>

<span class="advanced" style="display:none">&nbsp;</span>
: <span class="advanced" style="display:none"><input type="checkbox" name="a4" value="197"<?=in_array(197,$events) ? ' checked' : ''?>><span style="display:inline-block;width:72px">197</span>Current pending sector count</span>

<span class="advanced" style="display:none">&nbsp;</span>
: <span class="advanced" style="display:none"><input type="checkbox" name="a5" value="198"<?=in_array(198,$events) ? ' checked' : ''?>><span style="display:inline-block;width:72px">198</span>Uncorrectable sector count</span>

<span class="advanced" style="display:none">&nbsp;</span>
: <span class="advanced" style="display:none"><input type="text" name="custom" value="<?=$notify['custom']?>" maxlength="3" style="width:25px;margin-right:57px">Custom attribute number</span>

<button type="button" onclick="resetNotify(this.form);">Default</button>
: <input type="submit" name="#apply" value="Apply"><button type="button" onclick="done()">Done</button></td>
</form>
