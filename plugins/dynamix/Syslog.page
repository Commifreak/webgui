Menu="UNRAID-OS"
Title="System Log"
---
<?PHP
/* Copyright 2015, Lime Technology
 * Copyright 2015, Bergware International.
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License version 2,
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 */
?>
<style>
font.error {color:#D8000C;background-color:#FFBABA;}
font.warn {color:#9F6000;background-color:#FEEFB3;}
font.system {color:#00529B;background-color:#BDE5F8;}
font.array {color:#4F8A10;background-color:#DFF2BF;}
font.xs {font-size:small;padding:2px 0 2px 6px;margin-right:6px;}
</style>
<script>
function cleanUp() {
  if (document.hasFocus()) {
    $('input[value="Downloading..."]').val('Download').prop('disabled',false);
    $.post('/webGui/include/Download.php',{cmd:'delete',file:'<?=$zip?>'});
  } else {
    setTimeout(cleanUp,4000);
  }
}
function syslog() {
  $('input[value="Download"]').val('Downloading...').prop('disabled',true);
  $.post('/webGui/include/Download.php',{cmd:'save',source:'/var/log/syslog',file:'<?=$zip?>'},function(zip) {
    location = zip;
    setTimeout(cleanUp,4000);
  });
}
function highlight(checked,line) {
  if (checked) {
    if (line=='E') $('font.error-').toggleClass('error error-');
    if (line=='W') $('font.warn-').toggleClass('warn warn-');
    if (line=='S') $('font.system-').toggleClass('system system-');
    if (line=='A') $('font.array-').toggleClass('array array-');
  } else {
    if (line=='E') $('font.error').toggleClass('error error-');
    if (line=='W') $('font.warn').toggleClass('warn warn-');
    if (line=='S') $('font.system').toggleClass('system system-');
    if (line=='A') $('font.array').toggleClass('array array-');
  }
}
$('.tabs').append("<span class='status vhshift'><font class='error xs'>Error<input type='checkbox' onclick='highlight(this.checked,\"E\")' checked></font><font class='warn xs'>Warning<input type='checkbox' onclick='highlight(this.checked,\"W\")' checked></font><font class='system xs'>System<input type='checkbox' onclick='highlight(this.checked,\"S\")' checked></font><font class='array xs'>Array<input type='checkbox' onclick='highlight(this.checked,\"A\")' checked></font><input type='button' value='Download' onclick='syslog()'></span>");
</script>
<?
$zip = str_replace(' ','_',strtolower($var['NAME']))."-syslog-".date('Ymd-Hi').".zip";

require_once 'webGui/include/ColorCoding.php';

$lines = @file('/var/log/syslog',FILE_IGNORE_NEW_LINES|FILE_SKIP_EMPTY_LINES);
echo "<pre class='up'>";
foreach ($lines as $line) {
  $font = "font";
  foreach ($match as $type) foreach ($type['text'] as $text) if (preg_match("/$text/i",$line)) {$font = "font class='{$type['class']}'"; break 2;}
  echo "<$font>".htmlentities($line)."</font><br>";
}
echo "</pre>";
?>
<input type="button" value="Download" onclick="syslog()"><input type="button" value="Done" onclick="done()">
