Menu="Parity Data Cache"
Title="Health"
Cond="(strstr($disks[$name]['status'],'_NP')===false)"
---
<?PHP
/* Copyright 2014, Lime Technology
 * Copyright 2014, Bergware International.
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License version 2,
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 */
?>

<?
$disk  = $disks[$name];
$cname = my_disk($name);
$dev   = $disk['device'];
$path  = "/var/tmp";
$file  = $name."-smart-".date('Ymd-Hi');;
$refs  = array(); $n = 0;
foreach ($disks as $ref) {
  if ($ref['name']=='flash') continue;
  $refs[] = $ref['name'];
  if ($ref['name']==$name) $i = $n;
  $n++;
}
$end = count($refs)-1;
$prev = $i>0 ? $refs[$i-1] : $refs[$end];
$next = $i<$end ? $refs[$i+1] : $refs[0];
?>
<link type="text/css" rel="stylesheet" href="/webGui/styles/disk.health.css">
<link type="text/css" rel="stylesheet" href="/webGui/styles/jquery.stylesidebar.css">
<script type="text/javascript" src="/webGui/scripts/jquery.stylesidebar.js"></script>

<script>
function cleanUp() {
  if (document.hasFocus()) {
    $.post('/webGui/include/Download.php',{cmd:'delete',file:'<?="$path/$file"?>'});
    $.post('/webGui/include/Download.php',{cmd:'delete',file:'<?="$docroot/$file.rtf"?>'});
  } else {
    setTimeout(cleanUp,4000);
  }
}  
function saveSMART() {
  $.get('/webGui/include/SmartInfo.php',{cmd:'save',port:'<?=$dev?>',file:'<?="$path/$file"?>'}, function() {
    $.post('/webGui/include/Download.php',{cmd:'save',raw:'windows',root:'<?=$docroot?>',file:'<?="$path/$file"?>'},function(data) {
      location = data;
      setTimeout(cleanUp,4000);
    });
  });
}
$(function(){$('li').StyleSidebar({displayDivId:'mainContent',pageMinHeight:'auto'});});
</script>

<div id="menuDiv" style="overflow:hidden">
<ul id="SystemProfilerStyleSidebar">
<li class="ajaxlink"><a href="/webGui/include/SmartInfo.php?cmd=IDENTITY&disk=<?=$cname?>&port=<?=$dev?>">Disk identity</a></li>
<li class="ajaxlink"><a href="/webGui/include/SmartInfo.php?cmd=ATTRIBUTES&disk=<?=$cname?>&port=<?=$dev?>">Disk attributes</a></li>
<li class="ajaxlink"><a href="/webGui/include/SmartInfo.php?cmd=CAPABILITIES&disk=<?=$cname?>&port=<?=$dev?>">Disk capabilities</a></li>
<li class="ajaxlink"><a href="/webGui/include/SmartInfo.php?cmd=TESTLOG&disk=<?=$cname?>&port=<?=$dev?>">Disk self-test log</a></li>
<li class="ajaxlink"><a href="/webGui/include/SmartInfo.php?cmd=ERRORLOG&disk=<?=$cname?>&port=<?=$dev?>">Disk error log</a></li>
<li class="ajaxlink"><a href="/webGui/include/SmartInfo.php?cmd=SELFTEST&disk=<?=$cname?>&port=<?=$dev?>">Run disk self-test</a></li>
</ul>
<div id="mainContent"><!-- content  --></div>
</div>
<a href='/Main/Data?name=<?=$prev?>'><input type='button' value='Previous'></a><a href='/Main/Data?name=<?=$next?>'><input type='button' value='Next'></a><input type="button" value="Attributes" onclick="saveSMART()"><input type="button" value="Done" onclick="done()">
